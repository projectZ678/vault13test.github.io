<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title id="pageTitle">@user – Vault 13</title>

  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Roboto+Mono:wght@300;400;700&display=swap"
        rel="stylesheet">
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    :root{
      --bg:#000;--card-bg:rgba(15,15,30,.6);--card-bg-solid:rgba(10,10,25,.9);
      --border:rgba(138,43,226,.4);--glow-inner:inset 0 0 25px rgba(138,43,226,.3);
      --glow-outer:0 0 35px rgba(138,43,226,.6);--accent:#8a2be2;--accent2:#00d4ff;
      --text:#e0d9ff;--text-dim:#b19cd9;--transition:all .4s cubic-bezier(.23,1,.32,1);
    }
    *{margin:0;padding:0;box-sizing:border-box;}
    body{background:var(--bg);color:var(--text);font-family:'Roboto Mono',monospace;
         min-height:100vh;display:flex;flex-direction:column;align-items:center;
         padding:3rem 1.5rem;overflow-x:hidden;position:relative;line-height:1.6;}

    .stars{position:fixed;inset:0;pointer-events:none;overflow:hidden;z-index:-1;}
    .stars::before{content:'';position:absolute;inset:0;
                   background:radial-gradient(circle at 20% 80%,rgba(138,43,226,.15),transparent 50%),
                              radial-gradient(circle at 80% 20%,rgba(0,212,255,.15),transparent 50%);
                   animation:nebulaPulse 12s infinite;}
    .star{position:absolute;background:#fff;border-radius:50%;animation:twinkle 3s infinite;}
    @keyframes nebulaPulse{0%,100%{opacity:.7}50%{opacity:1}}
    @keyframes twinkle{0%,100%{opacity:0;transform:scale(.8)}50%{opacity:1;transform:scale(1.2)}}

    .grid{position:fixed;inset:0;background:linear-gradient(rgba(138,43,226,.03) 1px,transparent 1px),
                                      linear-gradient(90deg,rgba(0,212,255,.03) 1px,transparent 1px);
          background-size:60px 60px;animation:gridMove 25s linear infinite;opacity:.6;z-index:-1;}
    @keyframes gridMove{0%{transform:translate(0,0)}100%{transform:translate(-60px,-60px)}}

    .profile-bg{
      position:fixed;inset:0;background:center/cover no-repeat;
      filter:brightness(0.6) blur(1px);z-index:-2;opacity:0;transition:opacity 1.2s;
    }
    .profile-bg.active{opacity:1;}

    .profile-container{
      display:flex;gap:2rem;justify-content:center;align-items:flex-start;
      flex-wrap:wrap;max-width:960px;width:100%;margin-bottom:3rem;
    }
    .profile-card{
      background:var(--card-bg-solid);border:1px solid var(--border);
      border-radius:24px;padding:3rem;width:100%;max-width:460px;
      text-align:center;box-shadow:var(--glow-inner),var(--glow-outer);
      backdrop-filter:blur(18px);position:relative;overflow:hidden;flex:1;
    }
    .avatar{width:160px;height:160px;border-radius:50%;border:4px solid var(--border);
            margin:0 auto 1.8rem;background:#222 center/cover no-repeat;box-shadow:var(--glow-inner);}
    
    .display-name{
      font:2rem 'Orbitron',sans-serif;color:var(--text);
      text-shadow:0 0 20px var(--accent);margin-bottom:.4rem;
      display:flex;align-items:center;justify-content:center;gap:0.35rem;
    }
    .username{font-size:1rem;color:var(--text-dim);margin-bottom:1.6rem;letter-spacing:1px;}
    .bio{font-size:1.05rem;color:#ddd;line-height:1.7;margin-bottom:2.2rem;
         min-height:3.5em;padding:0 1rem;}

    .social-links{display:flex;flex-wrap:wrap;gap:1.2rem;justify-content:center;margin-top:2rem;}
    .social-btn{width:52px;height:52px;background:var(--card-bg);border:1px solid var(--border);
                border-radius:50%;display:flex;align-items:center;justify-content:center;
                transition:var(--transition);box-shadow:var(--glow-inner);}
    .social-btn:hover{transform:translateY(-5px);box-shadow:var(--glow-inner),var(--glow-outer);
                      background:rgba(138,43,226,.3);}
    .social-btn img{width:28px;height:28px;filter:brightness(0) invert(1);}

    .viewer-box{
      background:var(--card-bg-solid);border:1px solid var(--border);
      border-radius:24px;padding:2rem;width:100%;max-width:360px;
      box-shadow:var(--glow-inner),var(--glow-outer);backdrop-filter:blur(18px);
      display:none;flex:0 0 340px;height:fit-content;
    }
    .viewer-title{
      font:1.3rem 'Orbitron',sans-serif;color:var(--accent2);margin-bottom:1rem;
      text-shadow:0 0 15px var(--accent2);text-align:center;
    }
    .viewer-list{font-size:0.9rem;color:#ccc;line-height:1.7;max-height:380px;overflow-y:auto;}
    .viewer-item{
      padding:.5rem 0;border-bottom:1px solid rgba(138,43,226,.15);
      display:flex;justify-content:space-between;align-items:center;
    }
    .viewer-item strong{color:var(--accent2);}
    .viewer-item span{font-size:0.78rem;color:#888;}

    .home-btn{
      position:relative;display:block;margin:2rem auto 0;
      width:60px;height:60px;background:radial-gradient(circle,#8a2be2,#00d4ff);
      border-radius:50%;display:flex;align-items:center;justify-content:center;
      box-shadow:0 0 30px rgba(138,43,226,.8),0 0 50px rgba(0,212,255,.6);
      animation:pulseGlow 2s infinite;transition:var(--transition);
    }
    .home-btn:hover{transform:scale(1.1);}
    .home-btn i{color:#000;font-size:1.5rem;}
    @keyframes pulseGlow{
      0%,100%{box-shadow:0 0 30px rgba(138,43,226,.8),0 0 50px rgba(0,212,255,.6)}
      50%{box-shadow:0 0 40px rgba(138,43,226,1),0 0 70px rgba(0,212,255,.8)}
    }

    #bgAudio{display:none;}

    #audioUnlock{
      position:fixed;bottom:2rem;left:50%;transform:translateX(-50%);
      background:rgba(10,10,25,.95);border:1px solid var(--border);
      border-radius:16px;padding:1rem 1.5rem;font-size:.95rem;
      color:var(--text);text-align:center;box-shadow:var(--glow-outer);
      backdrop-filter:blur(12px);z-index:1000;opacity:0;visibility:hidden;
      transition:opacity .4s,visibility .4s;
    }
    #audioUnlock.show{opacity:1;visibility:visible;}

    /* VERIFIED BADGE — SMALLER & CLEAN */
    .verified-badge{
      color:#1DA1F2;
      font-size:0.95em;
      margin-left:0.25rem;
      text-shadow:0 0 8px #1DA1F2;
      animation:pulseCheck 1.2s infinite ease-in-out;
    }
    @keyframes pulseCheck{
      0%,100%{transform:scale(1);opacity:0.9}
      50%{transform:scale(1.08);opacity:1}
    }

    @media (max-width: 900px){
      .profile-container{flex-direction:column;align-items:center;}
      .viewer-box{max-width:460px;flex:1;}
    }
  </style>
</head>
<body>
  <div class="stars" id="stars"></div>
  <div class="grid"></div>
  <div class="profile-bg" id="profileBg"></div>

  <div class="profile-container">
    <div class="profile-card">
      <div class="avatar" id="avatar"></div>
      <div class="display-name" id="displayName">Loading…</div>
      <div class="username" id="username">@user</div>
      <div class="bio" id="bio">No bio yet.</div>
      <div class="social-links" id="socialLinks"></div>
    </div>

    <div class="viewer-box" id="viewerBox">
      <div class="viewer-title">Who Viewed Me</div>
      <div class="viewer-list" id="viewerList">No visitors yet.</div>
    </div>
  </div>

  <a href="#" class="home-btn" id="homeBtn" title="Back to Dashboard">
    <i class="fas fa-home"></i>
  </a>

  <audio id="bgAudio" preload="auto" loop></audio>
  <div id="audioUnlock">Click anywhere to enable music</div>

  <script>
    const $ = id => document.getElementById(id);

    let username = null;
    const pathMatch = location.pathname.match(/@([^\/]+)$/i);
    if (pathMatch) username = pathMatch[1].toLowerCase();
    if (!username) {
      const params = new URLSearchParams(location.search);
      username = params.get('u')?.toLowerCase();
    }
    if (!username) {
      document.body.innerHTML = `<h1 style="color:var(--accent2);text-align:center;margin-top:6rem;">User not found.</h1>`;
      throw '';
    }

    document.getElementById('pageTitle').textContent = `@${username} – Vault 13`;

    const profileKey = `profile_${username}`;
    const profile = JSON.parse(localStorage.getItem(profileKey)) || {};

    const viewer = localStorage.getItem('loggedIn');
    if (viewer && viewer !== username) {
      const viewersKey = `viewers_${username}`;
      let viewers = JSON.parse(localStorage.getItem(viewersKey) || '[]');
      const timestamp = new Date().toISOString().split('T')[0];
      const existing = viewers.find(v => v.user === viewer);
      if (existing) existing.date = timestamp;
      else viewers.push({ user: viewer, date: timestamp });
      viewers = viewers.slice(-20);
      localStorage.setItem(viewersKey, JSON.stringify(viewers));
    }

    const viewsKey = `views_${username}`;
    let views = parseInt(localStorage.getItem(viewsKey) || '0') + 1;
    localStorage.setItem(viewsKey, views);

    $('username').textContent = `@${username}`;

    // VERIFIED BADGE
    const displayNameEl = $('displayName');
    const displayName = profile.name || username;
    const verifiedBadge = profile.verified 
      ? ' <i class="fas fa-check-circle verified-badge" title="Verified by Vault 13"></i>' 
      : '';
    displayNameEl.innerHTML = displayName + verifiedBadge;

    $('bio').textContent = profile.bio || 'No bio yet.';

    const avatarUrl = profile.avatar || 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 120"><circle cx="60" cy="60" r="50" fill="%23202050"/><path fill="%238a2be2" d="M60 30a30 30 0 0 0-30 30c0 12 12 30 30 30s30-18 30-30a30 30 0 0 0-30-30z"/></svg>';
    $('avatar').style.backgroundImage = `url(${avatarUrl})`;

    if (profile.bgImage) {
      const bg = $('profileBg');
      bg.style.backgroundImage = `url(${profile.bgImage})`;
      bg.classList.add('active');
    }

    const socialContainer = $('socialLinks');
    const platforms = {
      discord: {icon:'https://cdn.jsdelivr.net/npm/simple-icons@v7/icons/discord.svg', format:u=>u.includes('discord.gg/')?u:`https://discord.gg/${u}`},
      twitter: {icon:'https://cdn.jsdelivr.net/npm/simple-icons@v7/icons/twitter.svg', format:u=>`https://twitter.com/${u}`},
      instagram:{icon:'https://cdn.jsdelivr.net/npm/simple-icons@v7/icons/instagram.svg', format:u=>`https://instagram.com/${u}`},
      twitch:   {icon:'https://cdn.jsdelivr.net/npm/simple-icons@v7/icons/twitch.svg', format:u=>`https://twitch.tv/${u}`},
      github:   {icon:'https://cdn.jsdelivr.net/npm/simple-icons@v7/icons/github.svg', format:u=>`https://github.com/${u}`},
      youtube:  {icon:'https://cdn.jsdelivr.net/npm/simple-icons@v7/icons/youtube.svg', format:u=>`https://youtube.com/@${u}`},
      tiktok:   {icon:'https://cdn.jsdelivr.net/npm/simple-icons@v7/icons/tiktok.svg', format:u=>`https://tiktok.com/@${u}`},
      spotify:  {icon:'https://cdn.jsdelivr.net/npm/simple-icons@v7/icons/spotify.svg', format:u=>`https://open.spotify.com/user/${u}`},
      steam:    {icon:'https://cdn.jsdelivr.net/npm/simple-icons@v7/icons/steam.svg', format:u=>`https://steamcommunity.com/id/${u}`},
      reddit:   {icon:'https://cdn.jsdelivr.net/npm/simple-icons@v7/icons/reddit.svg', format:u=>`https://reddit.com/user/${u}`}
    };

    (profile.links || []).forEach(link => {
      const p = platforms[link.platform];
      if (!p) return;
      const a = document.createElement('a');
      a.href = p.format(link.username);
      a.target = '_blank';
      a.rel = 'noopener noreferrer';
      a.className = 'social-btn';
      a.title = link.platform;
      a.innerHTML = `<img src="${p.icon}" alt="${link.platform}">`;
      socialContainer.appendChild(a);
    });

    // MUSIC AUTO-PLAY WITH UNLOCK
    let audioUnlocked = false;
    const audio = $('bgAudio');
    audio.loop = true;
    audio.volume = 0.6;
    const unlockPrompt = $('audioUnlock');

    if (profile.mp3) {
      audio.src = profile.mp3;

      const tryPlay = () => {
        audio.play().then(() => {
          audioUnlocked = true;
          unlockPrompt.classList.remove('show');
        }).catch(() => {
          unlockPrompt.classList.add('show');
        });
      };

      const unlockAudio = () => {
        if (audioUnlocked) return;
        audio.play().then(() => {
          audioUnlocked = true;
          unlockPrompt.classList.remove('show');
        }).catch(() => {});
        document.body.removeEventListener('click', unlockAudio);
        document.body.removeEventListener('touchstart', unlockAudio);
        document.body.removeEventListener('keydown', unlockAudio);
      };

      if (document.readyState === 'complete') tryPlay();
      else window.addEventListener('load', tryPlay);

      document.body.addEventListener('click', unlockAudio);
      document.body.addEventListener('touchstart', unlockAudio);
      document.body.addEventListener('keydown', unlockAudio);
    }

    // VIEWERS BOX
    const loggedInUser = localStorage.getItem('loggedIn');
    if (loggedInUser && loggedInUser === username) {
      const viewersKey = `viewers_${username}`;
      const viewers = JSON.parse(localStorage.getItem(viewersKey) || '[]');
      const list = $('viewerList');
      const box = $('viewerBox');

      if (viewers.length > 0) {
        list.innerHTML = viewers.reverse().slice(0, 20).map(v =>
          `<div class="viewer-item"><strong>@${v.user}</strong><span>${v.date}</span></div>`
        ).join('');
      } else {
        list.innerHTML = '<em style="opacity:.6;">No visitors yet.</em>';
      }
      box.style.display = 'block';
    }

    // HOME BUTTON
    const base = location.origin + location.pathname.replace(/profile[^/]*$/, '');
    $('homeBtn').href = loggedInUser
      ? `${base}dashboard.html?u=${loggedInUser}`
      : `${base}dashboard.html`;

    // STARS
    function createStars() {
      const c = $('stars');
      for (let i = 0; i < 70; i++) {
        const s = document.createElement('div');
        s.className = 'star';
        s.style.width = s.style.height = Math.random() * 2.5 + 1 + 'px';
        s.style.left = Math.random() * 100 + '%';
        s.style.top = Math.random() * 100 + '%';
        s.style.animationDelay = Math.random() * 3 + 's';
        c.appendChild(s);
      }
    }
    createStars();

    // SECURITY
    document.addEventListener('contextmenu', e => e.preventDefault());
    document.addEventListener('selectstart', e => e.preventDefault());
    document.addEventListener('dragstart', e => e.preventDefault());
  </script>
</body>
</html>