<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vault 13 – Dashboard</title>

  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Roboto+Mono:wght@300;400;700&display=swap"
        rel="stylesheet">
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    :root{
      --bg:#000;--card-bg:rgba(15,15,30,.6);--card-bg-solid:rgba(10,10,25,.9);
      --border:rgba(138,43,226,.4);--glow-inner:inset 0 0 25px rgba(138,43,226,.3);
      --glow-outer:0 0 35px rgba(138,43,226,.6);--accent:#8a2be2;--accent2:#00d4ff;
      --text:#e0d9ff;--text-dim:#b19cd9;--input-bg:rgba(20,20,50,.7);
      --transition:all .4s cubic-bezier(.23,1,.32,1);
      --check-fill:#e0d9ff; /* Soft neon white */
    }
    *{margin:0;padding:0;box-sizing:border-box;}
    body{background:var(--bg);color:var(--text);font-family:'Roboto Mono',monospace;
         height:100vh;overflow:hidden;display:flex;justify-content:center;align-items:center;cursor:none;}
    button,input,a,select,textarea{cursor:none;}

    .crosshair{position:fixed;width:20px;height:20px;pointer-events:none;z-index:9999;
               transform:translate(-50%,-50%);background:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path fill="%238a2be2" d="M9 2h2v16H9z"/><path fill="%238a2be2" d="M2 9h16v2H2z"/></svg>') center/contain no-repeat;
               filter:drop-shadow(0 0 8px var(--accent2));animation:pulseCross 2s infinite;display:none;}
    @keyframes pulseCross{0%,100%{transform:translate(-50%,-50%) scale(1)}50%{transform:translate(-50%,-50%) scale(1.15)}}

    .input-group{margin:1rem 0;}
    input,select,textarea{width:100%;padding:1.1rem 1rem;background:var(--input-bg);
                         border:1px solid var(--border);border-radius:12px;color:var(--text);
                         font-size:1.1rem;outline:none;transition:var(--transition);
                         box-shadow:var(--glow-inner);backdrop-filter:blur(12px);}
    input::placeholder,textarea::placeholder{color:#8a2be288;font-style:italic;}
    input:focus,select:focus,textarea:focus{border-color:var(--accent2);
                                            box-shadow:var(--glow-inner),0 0 0 3px rgba(0,212,255,.4);
                                            background:rgba(25,25,55,.9);}
    select{background:var(--input-bg) url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath fill='%238a2be2' d='M0 0l6 8 6-8z'/%3E%3C/svg%3E") no-repeat right 1rem center/12px;}

    .stars{position:absolute;inset:0;pointer-events:none;overflow:hidden;}
    .stars::before{content:'';position:absolute;inset:0;
                   background:radial-gradient(circle at 20% 80%,rgba(138,43,226,.15),transparent 50%),
                              radial-gradient(circle at 80% 20%,rgba(0,212,255,.15),transparent 50%);
                   animation:nebulaPulse 12s infinite;}
    .star{position:absolute;background:#fff;border-radius:50%;animation:twinkle 3s infinite;}
    @keyframes nebulaPulse{0%,100%{opacity:.7}50%{opacity:1}}
    @keyframes twinkle{0%,100%{opacity:0;transform:scale(.8)}50%{opacity:1;transform:scale(1.2)}}

    .grid{position:absolute;inset:0;background:linear-gradient(rgba(138,43,226,.03) 1px,transparent 1px),
                                          linear-gradient(90deg,rgba(0,212,255,.03) 1px,transparent 1px);
          background-size:60px 60px;animation:gridMove 25s linear infinite;opacity:0;transition:1.5s;}
    @keyframes gridMove{0%{transform:translate(0,0)}100%{transform:translate(-60px,-60px)}}

    .scanline{position:absolute;top:0;width:100%;height:3px;
              background:linear-gradient(to bottom,transparent,var(--accent2),transparent);
              animation:scan 7s linear infinite;opacity:0;}
    @keyframes scan{0%{transform:translateY(-100%)}100%{transform:translateY(100vh)}}

    .dashboard{position:fixed;inset:0;display:grid;grid-template-columns:260px 1fr;
               z-index:300;opacity:0;visibility:hidden;transition:1s;}
    .dashboard.active{opacity:1;visibility:visible;}

    .sidebar{background:var(--card-bg-solid);padding:1.5rem;border-right:1px solid var(--border);
              overflow-y:auto;box-shadow:var(--glow-inner);backdrop-filter:blur(12px);}
    .site-name{display:flex;align-items:center;gap:.8rem;margin-bottom:1.5rem;
               font:1.3rem 'Orbitron',sans-serif;color:var(--text);text-shadow:0 0 20px var(--accent);}
    .logo-small{width:44px;height:44px;border-radius:50%;background:#222 center/cover no-repeat;
                border:2px solid var(--border);box-shadow:var(--glow-inner);}
    .admin-badge{background:linear-gradient(135deg,#8a2be2,#00d4ff);color:#000;font-size:.65rem;
                 padding:.25rem .6rem;border-radius:6px;font-weight:900;letter-spacing:1.5px;
                 margin-left:auto;box-shadow:0 0 20px rgba(138,43,226,.8);}

    .nav-item{display:flex;align-items:center;justify-content:center;padding:1rem;
              border-radius:12px;color:#b19cd9;font-size:1.4rem;transition:var(--transition);
              background:var(--card-bg);border:1px solid var(--border);box-shadow:var(--glow-inner);
              backdrop-filter:blur(12px);margin:.4rem 0;}
    .nav-item:hover,.nav-item.active{background:rgba(138,43,226,.25);color:var(--text);
                                      box-shadow:var(--glow-inner),0 0 20px rgba(138,43,226,.4);}
    .nav-item i{width:100%;text-align:center;}

    .main{padding:2rem;overflow-y:auto;}
    .section-title{font-size:1.4rem;margin-bottom:1.8rem;color:var(--text);
                   text-shadow:0 0 20px var(--accent);font-weight:700;}

    .vault-status-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:1.5rem;}
    .status-card{background:var(--card-bg);padding:1.6rem;border-radius:16px;
                 border:1px solid var(--border);box-shadow:var(--glow-inner);
                 backdrop-filter:blur(14px);text-align:center;transition:var(--transition);}
    .status-card:hover{transform:translateY(-6px);box-shadow:var(--glow-inner),var(--glow-outer);}
    .status-icon{font-size:2.4rem;margin-bottom:.6rem;color:var(--accent2);text-shadow:0 0 15px var(--accent2);}
    .status-value{font-size:1.3rem;font-weight:700;color:var(--text);text-shadow:0 0 12px var(--accent);
                  word-break:break-all;}

    .overview-card{background:var(--card-bg);padding:1.6rem;border-radius:16px;
                   border:1px solid var(--border);box-shadow:var(--glow-inner);
                   backdrop-filter:blur(14px);margin-bottom:1.6rem;}
    .overview-card-title{font-size:1.1rem;font-weight:700;color:var(--accent2);
                         margin-bottom:1rem;text-transform:uppercase;letter-spacing:1.5px;
                         text-shadow:0 0 12px var(--accent2);display:flex;align-items:center;gap:.5rem;}
    .overview-card-content{font-size:.95rem;color:#ccc;line-height:1.5;}

    .customize-group{background:var(--card-bg);padding:1.6rem;border-radius:16px;
                     border:1px solid var(--border);box-shadow:var(--glow-inner);
                     backdrop-filter:blur(14px);margin-bottom:1.6rem;}
    .group-title{font-size:1.1rem;font-weight:700;color:var(--accent2);
                 margin-bottom:1.2rem;text-transform:uppercase;letter-spacing:1.5px;
                 text-shadow:0 0 12px var(--accent2);}
    .social-input{display:flex;gap:.6rem;align-items:center;margin-bottom:.6rem;}
    .social-input button{background:rgba(255,0,0,.2);color:#ff6666;border:1px solid rgba(255,0,0,.3);
                         padding:.5rem .9rem;font-size:.8rem;border-radius:10px;}
    .avatar-preview{width:150px;height:150px;border:2px solid var(--border);
                    border-radius:50%;margin:0 auto 1rem;background:#222 center/cover no-repeat;
                    box-shadow:var(--glow-inner);}

    .upload-label{display:inline-block;padding:.7rem 1.4rem;background:var(--card-bg);
                  border:1px solid var(--border);border-radius:12px;transition:var(--transition);
                  box-shadow:var(--glow-inner);font-size:.95rem;backdrop-filter:blur(12px);}
    .upload-label:hover{background:rgba(0,212,255,.2);box-shadow:var(--glow-inner),var(--glow-outer);color:var(--text);}

    .btn{width:100%;padding:1.3rem;margin-top:1.3rem;background:var(--card-bg);
         color:var(--text);font:700 1.1rem 'Orbitron',sans-serif;text-transform:uppercase;
         letter-spacing:3px;border:1px solid var(--border);border-radius:12px;
         transition:var(--transition);box-shadow:var(--glow-inner);position:relative;overflow:hidden;
         backdrop-filter:blur(12px);}
    .btn:hover{transform:translateY(-4px);box-shadow:var(--glow-inner),var(--glow-outer);}
    .btn::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;
                 background:linear-gradient(90deg,transparent,var(--accent2),transparent);transition:.7s;}
    .btn:hover::before{left:100%;}

    .user-item{padding:.8rem;background:rgba(138,43,226,.1);border-radius:10px;
               margin-bottom:.6rem;display:flex;justify-content:space-between;align-items:center;font-size:.9rem;}

    /* ADMIN PANEL CUSTOM CHECKBOX — NO TEXT, SOFT NEON FILL */
    .verify-toggle {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      font-size: 0.9rem;
      color: var(--text-dim);
      user-select: none;
      transition: var(--transition);
    }
    .verify-toggle input[type="checkbox"] {
      appearance: none;
      width: 18px;
      height: 18px;
      background: var(--input-bg);
      border: 1px solid var(--border);
      border-radius: 6px;
      position: relative;
      box-shadow: var(--glow-inner);
      transition: var(--transition);
    }
    .verify-toggle input[type="checkbox"]:checked {
      background: var(--check-fill); /* Soft neon white */
      border-color: #b19cd9;
      box-shadow: inset 0 0 10px rgba(224, 217, 255, 0.4),
                  0 0 12px rgba(0, 212, 255, 0.4);
    }
    .verify-toggle:hover input {
      border-color: var(--accent2);
      box-shadow: inset 0 0 12px rgba(138, 43, 226, 0.3),
                  0 0 16px rgba(0, 212, 255, 0.5);
    }
    .verify-toggle:hover {
      color: var(--accent2);
    }

    .user-item button {
      background: rgba(255,0,0,.2);
      color: #ff6666;
      border: 1px solid rgba(255,0,0,.3);
      padding: .4rem .8rem;
      font-size: .75rem;
      border-radius: 8px;
      margin-left: .5rem;
      transition: var(--transition);
    }
    .user-item button:hover {
      background: rgba(255,0,0,.4);
      color: #fff;
      box-shadow: 0 0 12px rgba(255,0,0,.5);
    }
  </style>
</head>
<body>
  <div class="crosshair" id="crosshair"></div>
  <div class="stars" id="stars"></div>
  <div class="grid" id="grid"></div>
  <div class="scanline" id="scanline"></div>

  <div class="dashboard" id="dashboard">
    <div class="sidebar">
      <div class="site-name">
        <div class="logo-small" id="sidebarAvatar"></div>
        <div style="flex:1;">
          <div id="dashDisplayName">vault13.lol</div>
          <div style="font-size:.75rem;color:#b19cd9;" id="dashUsername"></div>
        </div>
        <span class="admin-badge" id="adminBadge" style="display:none;">FOUNDER</span>
      </div>

      <div class="nav-item active" data-section="overview" title="Overview"><i class="fas fa-chart-line"></i></div>
      <div class="nav-item" data-section="customize" title="Customize"><i class="fas fa-palette"></i></div>
      <div class="nav-item admin-only" data-section="admin" title="Admin Panel" style="display:none;"><i class="fas fa-cog"></i></div>

      <div style="height:1px;background:var(--border);margin:1.5rem 0;"></div>
      <div class="btn" id="logoutBtn" style="background:var(--text);color:#000;padding:1rem;font-size:.95rem;">Logout</div>
      <div class="btn" id="viewProfileBtn" style="margin-top:.5rem;padding:1rem;font-size:.95rem;">View Profile</div>
    </div>

    <div class="main" id="mainContent">
      <!-- OVERVIEW -->
      <div class="section" id="overview">
        <h2 class="section-title">Vault Status</h2>
        <div class="overview-card">
          <div class="overview-card-title" id="welcomeTitle"></div>
          <div class="overview-card-content" id="welcomeText"></div>
        </div>

        <div class="vault-status-grid">
          <div class="status-card" title="Operator"><div class="status-icon"><i class="fas fa-user-astronaut"></i></div><div class="status-value" id="dashUser">…</div></div>
          <div class="status-card" title="Profile URL"><div class="status-icon"><i class="fas fa-globe"></i></div><div class="status-value">vault13.lol/profile/<span id="urlUser"></span></div></div>
          <div class="status-card" title="Profile Views"><div class="status-icon"><i class="fas fa-eye"></i></div><div class="status-value" id="profileViews">0</div></div>
          <div class="status-card" title="Social Links"><div class="status-icon"><i class="fas fa-link"></i></div><div class="status-value" id="socialCount">0</div></div>
          <div class="status-card" title="Music Status"><div class="status-icon"><i class="fas fa-music"></i></div><div class="status-value" id="musicStatus">None</div></div>
          <div class="status-card" title="Background"><div class="status-icon"><i class="fas fa-image"></i></div><div class="status-value" id="bgStatus">None</div></div>
          <div class="status-card" title="Verified"><div class="status-icon"><i class="fas fa-shield-alt"></i></div><div class="status-value" id="verifiedStatus">No</div></div>
        </div>

        <div class="overview-card" style="margin-top:1.6rem;">
          <div class="overview-card-title">System Stats</div>
          <div class="vault-status-grid">
            <div class="status-card" title="Total Users"><div class="status-icon"><i class="fas fa-users"></i></div><div class="status-value" id="totalUsers">0</div></div>
            <div class="status-card" title="System Uptime"><div class="status-icon"><i class="fas fa-server"></i></div><div class="status-value" id="uptime">0s</div></div>
          </div>
        </div>
      </div>

      <!-- CUSTOMIZE -->
      <div class="section" id="customize" style="display:none;">
        <h2 class="section-title">Customize Profile</h2>

        <div class="customize-group">
          <div class="group-title">Identity</div>
          <div class="input-group"><input type="text" id="displayName" placeholder="Display Name"></div>
          <div class="input-group"><textarea id="bio" rows="3" placeholder="Bio / Tagline"></textarea></div>
        </div>

        <div class="customize-group">
          <div class="group-title">Media</div>
          <div style="text-align:center;">
            <img class="avatar-preview" id="avatarPreview" src="" alt="Avatar">
            <label for="avatarInput" class="upload-label">Change Avatar</label>
            <input type="file" id="avatarInput" accept="image/*" style="display:none;">
          </div>

          <div style="text-align:center;margin-top:1.2rem;">
            <label for="musicInput" class="upload-label">Upload MP3</label>
            <input type="file" id="musicInput" accept="audio/mp3" style="display:none;">
          </div>

          <div style="text-align:center;margin-top:1.2rem;">
            <label for="bgInput" class="upload-label">Upload Background (PNG/GIF)</label>
            <input type="file" id="bgInput" accept="image/png,image/gif" style="display:none;">
          </div>
        </div>

        <div class="customize-group">
          <div class="group-title">Social Links</div>
          <div id="socialLinks"></div>
          <button type="button" class="btn" id="addSocial"
                  style="margin-top:.6rem;width:auto;padding:.6rem 1.2rem;font-size:.9rem;">+ Add Link</button>
        </div>

        <button type="button" class="btn" id="saveCustomize">Save Changes</button>
      </div>

      <!-- ADMIN -->
      <div class="section" id="admin" style="display:none;">
        <h2 class="section-title">Admin Panel</h2>
        <div class="customize-group">
          <div class="group-title">System Controls</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;">
            <button class="btn admin-btn" id="clearAllBtn">Clear All Data</button>
            <button class="btn admin-btn" id="exportBtn">Export All Profiles</button>
            <button class="btn admin-btn" id="resetViewsBtn">Reset All Views</button>
            <button class="btn admin-btn" id="forceLogoutBtn">Force Logout All</button>
          </div>
        </div>
        <div class="customize-group">
          <div class="group-title">User Management</div>
          <div>Total Users: <span id="totalUsersAdmin">0</span></div>
          <div class="user-list" id="userList"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const platforms = {
      discord: {icon:'https://cdn.jsdelivr.net/npm/simple-icons@v7/icons/discord.svg',
                format:u=>u.includes('discord.gg/')?u:`https://discord.gg/${u}`},
      twitter: {icon:'https://cdn.jsdelivr.net/npm/simple-icons@v7/icons/twitter.svg',
                format:u=>`https://twitter.com/${u}`},
      instagram:{icon:'https://cdn.jsdelivr.net/npm/simple-icons@v7/icons/instagram.svg',
                 format:u=>`https://instagram.com/${u}`},
      twitch:   {icon:'https://cdn.jsdelivr.net/npm/simple-icons@v7/icons/twitch.svg',
                 format:u=>`https://twitch.tv/${u}`},
      github:   {icon:'https://cdn.jsdelivr.net/npm/simple-icons@v7/icons/github.svg',
                 format:u=>`https://github.com/${u}`},
      youtube:  {icon:'https://cdn.jsdelivr.net/npm/simple-icons@v7/icons/youtube.svg',
                 format:u=>`https://youtube.com/@${u}`},
      tiktok:   {icon:'https://cdn.jsdelivr.net/npm/simple-icons@v7/icons/tiktok.svg',
                 format:u=>`https://tiktok.com/@${u}`},
      spotify:  {icon:'https://cdn.jsdelivr.net/npm/simple-icons@v7/icons/spotify.svg',
                 format:u=>`https://open.spotify.com/user/${u}`},
      steam:    {icon:'https://cdn.jsdelivr.net/npm/simple-icons@v7/icons/steam.svg',
                 format:u=>`https://steamcommunity.com/id/${u}`},
      reddit:   {icon:'https://cdn.jsdelivr.net/npm/simple-icons@v7/icons/reddit.svg',
                 format:u=>`https://reddit.com/user/${u}`}
    };

    const $ = id => document.getElementById(id);
    let user = null, isAdmin = false;
    const startTime = Date.now();

    function createStars(){
      const c=$('stars');
      for(let i=0;i<80;i++){
        const s=document.createElement('div'); s.className='star';
        s.style.width=s.style.height=Math.random()*3+1+'px';
        s.style.left=Math.random()*100+'%';
        s.style.top=Math.random()*100+'%';
        s.style.animationDelay=Math.random()*3+'s';
        c.appendChild(s);
      }
    }

    function updateUptime(){
      const e=Math.floor((Date.now()-startTime)/1000);
      const h=Math.floor(e/3600), m=Math.floor((e%3600)/60), s=e%60;
      $('uptime').textContent=`${h}h ${m}m ${s}s`;
    }

    document.addEventListener('mousemove',e=>{
      const c=$('crosshair');
      c.style.left=e.clientX+'px'; c.style.top=e.clientY+'px'; c.style.display='block';
    });

    function goDash(u){
      user=u;
      const p=JSON.parse(localStorage.getItem(`profile_${u}`))||{};

      isAdmin = u==='xen';
      $('adminBadge').style.display=isAdmin?'inline':'none';
      document.querySelectorAll('.admin-only').forEach(el=>el.style.display=isAdmin?'block':'none');

      $('dashUser').textContent=u;
      $('dashDisplayName').textContent=p.name||u;
      $('dashUsername').textContent=`@${u}`;
      $('urlUser').textContent=`@${u}`;

      let v=parseInt(localStorage.getItem(`views_${u}`)||'0')+1;
      localStorage.setItem(`views_${u}`,v);
      animateValue('profileViews',0,v,800);

      $('socialCount').textContent=(p.links||[]).length;
      $('musicStatus').textContent=p.mp3?'Active':'None';
      $('bgStatus').textContent=p.bgImage?'Active':'None';
      $('verifiedStatus').textContent=p.verified?'Yes':'No';
      $('totalUsers').textContent=Object.keys(localStorage).filter(k=>k.startsWith('profile_')).length;

      if(isAdmin){
        $('welcomeTitle').innerHTML=`Hello, ${p.name||u} <span class="admin-badge">FOUNDER</span>`;
        $('welcomeText').textContent='As a Founder, you oversee the Vault 13 platform...';
      }else{
        $('welcomeTitle').textContent=`Welcome, ${p.name||u}`;
        $('welcomeText').textContent='Vault 13 is your social sharing platform...';
      }

      setAvatar(p.avatar);
      $('displayName').value=p.name||u;
      $('bio').value=p.bio||'';
      loadLinks(p.links||[]);
      if(isAdmin) loadAdminPanel();

      $('dashboard').classList.add('active');
    }

    function animateValue(id,start,end,dur){
      let t=null; const el=$(id);
      function step(now){ if(!t) t=now;
        const p=Math.min((now-t)/dur,1);
        el.textContent=Math.floor(p*(end-start)+start);
        if(p<1) requestAnimationFrame(step);
      }
      requestAnimationFrame(step);
    }

    function setAvatar(src){
      const url=src||'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 120"><circle cx="60" cy="60" r="50" fill="%23202050"/><path fill="%238a2be2" d="M60 30a30 30 0 0 0-30 30c0 12 12 30 30 30s30-18 30-30a30 30 0 0 0-30-30z"/></svg>';
      $('avatarPreview').src=url;
      $('sidebarAvatar').style.backgroundImage=`url(${url})`;
    }

    function loadLinks(arr){
      const c=$('socialLinks'); c.innerHTML='';
      arr.forEach(l=>addLinkInput(l.platform,l.username));
      if(!arr.length) addLinkInput();
    }
    function addLinkInput(p='',u=''){
      const d=document.createElement('div'); d.className='social-input';
      const opts=Object.keys(platforms).map(k=>`<option value="${k}" ${k===p?'selected':''}>${k}</option>`).join('');
      d.innerHTML=`<select>${opts}</select><input type="text" placeholder="username or invite" value="${u}"><button type="button">x</button>`;
      d.querySelector('button').onclick=()=>d.remove();
      $('socialLinks').appendChild(d);
    }
    $('addSocial').onclick=()=>addLinkInput();

    $('saveCustomize').onclick=()=>{
      const p=JSON.parse(localStorage.getItem(`profile_${user}`))||{};
      p.name=$('displayName').value.trim()||user;
      p.bio=$('bio').value.trim();
      p.links=[];
      document.querySelectorAll('#socialLinks .social-input').forEach(d=>{
        const plat=d.children[0].value.trim(), name=d.children[1].value.trim();
        if(plat&&name) p.links.push({platform:plat,username:name});
      });
      localStorage.setItem(`profile_${user}`,JSON.stringify(p));
      alert('Saved!');
      goDash(user);
    };

    $('avatarInput').onchange=e=>{
      const f=e.target.files[0]; if(!f) return;
      const r=new FileReader(); r.onload=ev=>{
        const b64=ev.target.result;
        setAvatar(b64);
        const p=JSON.parse(localStorage.getItem(`profile_${user}`))||{};
        p.avatar=b64; localStorage.setItem(`profile_${user}`,JSON.stringify(p));
      };
      r.readAsDataURL(f);
    };

    $('musicInput').onchange=e=>{
      const f=e.target.files[0]; if(!f) return;
      const r=new FileReader(); r.onload=ev=>{
        const b64=ev.target.result;
        const p=JSON.parse(localStorage.getItem(`profile_${user}`))||{};
        p.mp3=b64; localStorage.setItem(`profile_${user}`,JSON.stringify(p));
        $('musicStatus').textContent='Active';
        alert('MP3 uploaded! Auto-plays on profile.');
      };
      r.readAsDataURL(f);
    };

    $('bgInput').onchange=e=>{
      const f=e.target.files[0]; if(!f) return;
      const r=new FileReader(); r.onload=ev=>{
        const b64=ev.target.result;
        const p=JSON.parse(localStorage.getItem(`profile_${user}`))||{};
        p.bgImage=b64; localStorage.setItem(`profile_${user}`,JSON.stringify(p));
        $('bgStatus').textContent='Active';
        alert('Background uploaded! Visible on profile.');
      };
      r.readAsDataURL(f);
    };

    document.querySelectorAll('.nav-item[data-section]').forEach(n=>{
      n.onclick=()=>{
        document.querySelectorAll('.nav-item').forEach(i=>i.classList.remove('active'));
        n.classList.add('active');
        document.querySelectorAll('.section').forEach(s=>s.style.display='none');
        $(n.dataset.section).style.display='block';
        if(n.dataset.section==='admin') loadAdminPanel();
      };
    });

    $('logoutBtn').onclick=()=>{
      localStorage.removeItem('loggedIn');
      $('dashboard').classList.remove('active');
      setTimeout(()=>location.href='index.html',800);
    };

    $('viewProfileBtn').onclick=()=>{
      const base = location.origin + location.pathname.replace(/[^/]*$/, '');
      window.open(`${base}profile.html?u=${user}`, '_blank');
    };

    function loadAdminPanel(){
      const users=Object.keys(localStorage).filter(k=>k.startsWith('profile_')).map(k=>k.replace('profile_',''));
      $('totalUsersAdmin').textContent=users.length;
      const list=$('userList'); list.innerHTML='';
      users.forEach(u=>{
        const p=JSON.parse(localStorage.getItem(`profile_${u}`))||{};
        const div=document.createElement('div'); div.className='user-item';
        div.innerHTML=`
          <span>@${u}</span>
          <div style="display:flex;gap:.5rem;align-items:center;">
            <label class="verify-toggle">
              <input type="checkbox" ${p.verified?'checked':''}
                onchange="toggleVerify('${u}',this.checked)">
              <span>Verified</span>
            </label>
            <button onclick="deleteUser('${u}')">Delete</button>
          </div>`;
        list.appendChild(div);
      });
    }
    window.toggleVerify=(u,c)=>{ 
      const p=JSON.parse(localStorage.getItem(`profile_${u}`))||{}; 
      p.verified=c;
      localStorage.setItem(`profile_${u}`,JSON.stringify(p));
      if(u===user) $('verifiedStatus').textContent=c?'Yes':'No';
    };
    window.deleteUser=u=>{ 
      if(confirm(`Delete @${u}?`)){
        localStorage.removeItem(`profile_${u}`); 
        localStorage.removeItem(`views_${u}`);
        loadAdminPanel(); 
        if(u===user) $('logoutBtn').click();
      }
    };

    $('clearAllBtn').onclick=()=>{ if(confirm('ERASE ALL DATA?')){localStorage.clear();location.reload();} };
    $('exportBtn').onclick=()=>{
      const data=JSON.stringify(localStorage);
      const blob=new Blob([data],{type:'application/json'});
      const a=document.createElement('a'); a.href=URL.createObjectURL(blob);
      a.download='vault13_backup.json'; a.click();
    };
    $('resetViewsBtn').onclick=()=>{
      Object.keys(localStorage).filter(k=>k.startsWith('views_')).forEach(k=>localStorage.removeItem(k));
      alert('All views reset!');
    };
    $('forceLogoutBtn').onclick=()=>alert('Not implemented in localStorage mode.');

    window.onload=()=>{
      createStars();
      $('stars').style.opacity='1'; $('grid').style.opacity='1'; $('scanline').style.opacity='1';
      setInterval(updateUptime,1000);

      const savedUser = localStorage.getItem('loggedIn');
      const urlUser = new URLSearchParams(location.search).get('u');
      const finalUser = urlUser || savedUser;

      if(!finalUser || !localStorage.getItem(`profile_${finalUser}`)){
        alert('Access denied.');
        location.href='index.html';
      } else {
        localStorage.setItem('loggedIn', finalUser);
        goDash(finalUser);
      }
    };
  </script>
</body>
</html>